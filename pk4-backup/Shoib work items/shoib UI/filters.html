<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
	<head>
		<title> Filters </title>
		<if filters.user.theme>
			<assign theme=filters.user.theme__deref.derefValue>
		<else>
			<assign  theme="green">
		</if>
		<link rel="stylesheet" href="/atCRM/stylesheets/JSON/general.css"/>
		<link rel="stylesheet" href="/atCRM/stylesheets/JSON/${theme}/quickAdd.css"/>
		<link rel="stylesheet" href="/atCRM/stylesheets/JSON/${theme}/main.css"/>
		<link rel="stylesheet" href="/atCRM/stylesheets/JSON/${theme}/jquery.css"/>	
		<link rel="stylesheet" href="/atCRM/stylesheets/JSON/${theme}/fly.css"/>
		<style>
			.jsonHeading {
				color: black;
				font-family: Tahoma,Verdana;
				font-size: 20px;
				font-weight: normal;
				padding: 15px 5px 5px;
			}
			table, tr, td, body {
				color: #000000;
				font-family: tahoma,verdana;
				font-size: 12px;
				font-weight: normal;
			}
			.inputFieldClass{
				width: 150px !important;
			}
		</style>
	</head>
	<script type="text/javascript" src="/atCRM/javascript/JSON/commonElementFunction.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/jquery/jquery-1.4.2.min.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/jscal2.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/custom/advancedAdd/Activity.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/jquery/jquery-1.3.2.min.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/jquery/jquery.ui.core.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/jquery/jquery.ui.widget.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/jquery/jquery.ui.mouse.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/jquery/jquery.ui.sortable.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/jquery/jquery.ui.draggable.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/jquery/jquery.ui.position.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/jquery/jquery.ui.dialog.js"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/pickList.js" ></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/utils.js?rn=1"></script>
	<script type="text/javascript" src="/atCRM/javascript/JSON/en.js"></script>


<script type="text/javascript">
	var srchFldCntr=1;
	var entityName4Filter = getQueryParameter ("forEntity");
	var filterId4Filter = getQueryParameter ("id");
	var filterColData="";
	var dataForEditFilter="";
	var existingFilters="";
	var srchFldCntrArray=new Array();
		
	function initializeFilter()
	{
		var filterDiv= document.getElementById('divForFilterCreation');
		var container=document.createElement("div");
		var bottomDiv=document.createElement("div");

		filterDiv.appendChild(container);
		filterDiv.appendChild(bottomDiv);

		if(!filterId4Filter)
			CreateDIV(container, "jsonHeading", "containerHead", "Create Filter for "+entityName4Filter);
		else
			CreateDIV(container, "jsonHeading", "containerHead", "Edit Filter for "+entityName4Filter);

		var filterErrorDiv=CreateDIV(container, "jsonErrorDiv", "filterErrorDiv");
		filterErrorDiv.style.display="none";
			
		var filterDetailsDiv=CreateDIV(container, "filterDetailsDivClass", "filterDetailsDiv");

			if(!filterColData)
			{
				var url2Hit=zcServletPrefix+"/custom/JSON/system/filters.json?entityName="+entityName4Filter+"&filter_id="+filterId4Filter;
				$.ajax({
					type: "GET",
					url:url2Hit,
					dataType: "json",
					async: false,
					success: function (data){
						filterColData=data['entityBaseColumnList'];
						dataForEditFilter=data['dataForEditFilter'];
					}
				});
			}
			var filterDetailsTbl=CreateTable(filterDetailsDiv,'','','',3,3);
			var filterDetailsTblBdy=CreateBody(filterDetailsTbl);
			var filterDetailsTblTR=CreateTR(filterDetailsTblBdy);
			var filterDetailsTblTD=CreateTD(filterDetailsTblTR);
			filterDetailsTblTD.innerHTML="Filter Name<span style='color:red'>*</span>";
			var filterDetailsTblTD=CreateTD(filterDetailsTblTR);
			var filterName=CreateTEXTBOX(filterDetailsTblTD, "inputFieldClass", "filterName");
			filterName.style.width="150px";
			filterName.maxLength="50";
			AddBlurEventListener(filterName,(function (){return function() {checkFilterName(filterName);};})());

			var filterDetailsTblTR=CreateTR(filterDetailsTblBdy);
			var filterDetailsTblTD=CreateTD(filterDetailsTblTR);
			filterDetailsTblTD.innerHTML="Is public filter?";
			var filterDetailsTblTD=CreateTD(filterDetailsTblTR);
			var isPublic=CreateCheckbox(filterDetailsTblTD, "", "isPublic", 1);

			var filterCriteriaDiv=CreateDIV(container, "sectionDivHdr", "filterCriteriaDiv", "Filter Criteria:");
			var filterCriteriaBodyDiv=CreateDIV(container, "filterCriteriaBody", "filterCriteriaBodyDiv");
			filterCriteriaBodyDiv.style.border="1px solid #DDDDDD";
			filterCriteriaBodyDiv.style.paddingLeft="10px";
			filterCriteriaBodyDiv.style.paddingRight="10px";

			if(dataForEditFilter[0])
			{
				existingFilters=dataForEditFilter[0].existingFilters;
				document.getElementById('filterName').value=dataForEditFilter[0].filterName;
				document.getElementById('filterName').style.border="0px";
				
				if(dataForEditFilter[0].is_public==1)
				document.getElementById('isPublic').checked=true;
			}
			if(existingFilters.length>=1 && dataForEditFilter[0].existingFilters)
			createFilterCriteria(1,1);
			else
			createFilterCriteria(1);

			if(existingFilters.length>1)
			{
				for (i=2; i<=existingFilters.length; i++)
					createFilterCriteria(0,i);
			}

			bottomDiv.innerHTML="<br /><input type='button' value='Save' class='greenButton' onclick=\"saveFilterCriteria()\" style='width:80px'/>&nbsp;<input type='button' value='Cancel' class='greenButton' onclick=\"cancelFilterCriteria()\" style='width:80px'/>";
			bottomDiv.align="right";
			bottomDiv.style.marginRight="100px";
		}

		function createFilterCriteria(isFirst,fltrNoForEdit)
		{
			var container=document.getElementById('filterCriteriaBodyDiv');
			var containers=CreateDIV(container, "", "containerDev"+srchFldCntr);

			var containerTbl=CreateTable(containers);
			var containerTblBdy=CreateBody(containerTbl);
			var containerTblTR=CreateTR(containerTblBdy);
			var containerTblTD=CreateTD(containerTblTR);
			containerTblTD.width="100px";
			containerTblTD.innerHTML="&nbsp;";
			if(!isFirst)
			{
				containerTblTD.innerHTML="";
				var deleteCriteriaSpan=CreateSPAN(containerTblTD);
				deleteCriteriaSpan.innerHTML="<img src='/atCRM/images/delete.jpg' alt='Remove Criteria' onclick=\"removeFilterCriteria('"+srchFldCntr+"')\" style='cursor:pointer'/>&nbsp;";
				containerTblTD.innerHTML+="<select name='match"+srchFldCntr+"' id='match"+srchFldCntr+"' class='inputFieldClass' style='width:50px !important;'></select>";
				var matchSelBox=document.getElementById("match"+srchFldCntr);
				CreateOptionBox(matchSelBox, "", "", "and", "AND");
			}
			var containerTblTD=CreateTD(containerTblTR);
			containerTblTD.style.paddingTop="5px";
			containerTblTD.vAlign="top";
			containerTblTD.innerHTML+="<select name='searchfield"+srchFldCntr+"' id='searchfield"+srchFldCntr+"' onchange=\"showFilterCondSpan(this,'condDiv"+srchFldCntr+"','"+srchFldCntr+"')\" class='inputFieldClass'></select>";
			var searchField=document.getElementById("searchfield"+srchFldCntr);
			
			var columns=filterColData;
			CreateOptionBox(searchField, "", "", "", "- None -");
			var optBox;
			for(colCntr=0;colCntr<columns.length;colCntr++)
			{
				optBox=CreateOptionBox(searchField, "", "", columns[colCntr]['columnName'], columns[colCntr]['desc_name']);
				if(fltrNoForEdit && existingFilters[fltrNoForEdit-1]['attributeName']==columns[colCntr]['columnName'])
					optBox.selected=true;
			}
			
			var containerTblTD=CreateTD(containerTblTR);
			var condSpan=CreateSPAN(containerTblTD, "", "condDiv"+srchFldCntr);
			srchFldCntrArray.push(srchFldCntr);
			if(fltrNoForEdit)
				showFilterCondSpan(searchField,"condDiv"+srchFldCntr,srchFldCntr, fltrNoForEdit); //don't delete
			else
				showFilterCondSpan(searchField,"condDiv"+srchFldCntr,srchFldCntr); //don't delete
			
			srchFldCntr++;
		}

		function hideThisFilter(divElmId)
		{
			document.getElementById(divElmId).style.display="none";
		}
		function showThisFilter(divElmId)
		{
			document.getElementById(divElmId).style.display="block";
		}
		
		function showFilterCondSpan(selBx, contDivId, fldCntr, fltrNoForEdit)
		{
			var optBox="";
			var searchTxtFldVal="";
			var operatorsArray= new Array()
			operatorsArray["eq"]="Equal";
			operatorsArray["ne"]="Not Equal";
			operatorsArray["contains"]="contains";
			operatorsArray["does not contain"]="does not contain";
			operatorsArray["starts with"]="starts with";
			operatorsArray["does not start with"]="does not start with";
			operatorsArray["ends with"]="ends with";
			operatorsArray["does not end with"]="does not end with";

			var operatorsNumericArray= new Array()
			operatorsNumericArray["eq"]="Equal";
			operatorsNumericArray["ne"]="Not Equal";

			var operatorsFKArray= new Array()
			operatorsFKArray["eq"]="Equal";
			operatorsFKArray["ne"]="Not Equal";

			var operatorsDateArray= new Array()
			operatorsDateArray["lt"]="Lesser than";
			operatorsDateArray["gt"]="Greater than";


			var columnType="varchar";
			var columns=filterColData;
			for(colCntr=0;colCntr<columns.length;colCntr++)
			{
				if(columns[colCntr]['columnName']==selBx.value)
				{
					columnType=columns[colCntr]['columnType'];
					var isForeignKey=columns[colCntr]['isForeignKey'];
					var tableReferedTo=columns[colCntr]['tableReferedTo'];
					var columnReferedTo=columns[colCntr]['columnReferedTo'];
					var referColumnName=columns[colCntr]['referColumnName'];
					break;
				}
			}

			if(isForeignKey==1)
			{
				var pckLstVal="";
				var condSpan=document.getElementById(contDivId);
				condSpan.innerHTML="";
				var innerTbl=CreateTable(condSpan);
				var innerTblBdy=CreateBody(innerTbl);
				var innerTblTR=CreateTR(innerTblBdy);
				var innerTblTD=CreateTD(innerTblTR);



				var searchCondFld=CreateSelectBox(innerTblTD, "inputFieldClass", "searchCondFld"+fldCntr);
				for (var condFld in operatorsFKArray)
				{
					optBox=CreateOptionBox(searchCondFld, "", "", condFld, operatorsFKArray[condFld]);
					if(fltrNoForEdit && existingFilters[fltrNoForEdit-1]['operator']==condFld)
						optBox.selected=true;
				}

				AddChangeEventListener(searchCondFld,(function (fldCntr){return function() {changeFilterSearchTxtFld(searchCondFld, fldCntr);};})(fldCntr));

				if(fltrNoForEdit && existingFilters[fltrNoForEdit-1]['operator'])
					searchTxtFldVal=existingFilters[fltrNoForEdit-1]['value'];
				if(searchTxtFldVal)
				{
					var url="${servlet_prefix}/custom/JSON/smartSuggest/smartFillData.json?cols="+referColumnName+"&tblName="+tableReferedTo+"&pkCol="+columnReferedTo+"&pkVal="+searchTxtFldVal;
					$.ajax({
					type: "GET",
					url: url,
					dataType: "json",
					async: false,
					success: function (data)
					{
						var pckLstFillData=(data['enttInfo']['data']);
						pckLstFillData=pckLstFillData.split('~)');
						pckLstVal=pckLstFillData[1];
					}
					});
				}
				var innerTblTD=CreateTD(innerTblTR, "", "searchTxtFldTD"+fldCntr);
				var searchTxtFld=CreateHIDDEN(innerTblTD, "inputFieldClass", "searchTxtFld"+fldCntr, searchTxtFldVal);
				var searchTxtFld=CreateTEXTBOX(innerTblTD, "inputFieldClass", "searchTxtFld"+fldCntr+"txt", pckLstVal);
				searchTxtFld.maxLength="50";
				var innerTblTD=CreateTD(innerTblTR);
				if(tableReferedTo.toLowerCase()=='sbeuser')
				{
					innerTblTD.innerHTML+="<a id=\"searchTxtFld"+fldCntr+"pck\" onclick=\"populatePicklist('"+columnReferedTo+"','"+tableReferedTo+"','searchTxtFld"+fldCntr+"txt','','0','addEditForm','','"+selBx.value+"');\"><img src=\"/atCRM/images/addressBook.gif\" style=\"cursor: pointer; margin-left: 4px;\"></a>";
				}
				else
				{
					innerTblTD.innerHTML+="<a id=\"searchTxtFld"+fldCntr+"pck\" onclick=\"populatePicklist('','','searchTxtFld"+fldCntr+"txt','','0','addEditForm','"+zcServletPrefix+"/custom/JSON/smartSuggest/dropDownData.json?entity="+tableReferedTo+"','"+selBx.value+"');\"><img src=\"/atCRM/images/addressBook.gif\" style=\"cursor: pointer; margin-left: 4px;\"></a>";
				}

			}
			else
			{
				switch(columnType)
				{
					case "String":
					case "VARCHAR":
					case "varchar":
						var condSpan=document.getElementById(contDivId);
						condSpan.innerHTML="";
						var innerTbl=CreateTable(condSpan);
						var innerTblBdy=CreateBody(innerTbl);
						var innerTblTR=CreateTR(innerTblBdy);
						var innerTblTD=CreateTD(innerTblTR);
						var searchCondFld=CreateSelectBox(innerTblTD, "inputFieldClass", "searchCondFld"+fldCntr);

						for (var condFld in operatorsArray)
						{
							optBox=CreateOptionBox(searchCondFld, "", "", condFld, operatorsArray[condFld]);
							if(fltrNoForEdit && existingFilters[fltrNoForEdit-1]['operator']==condFld)
								optBox.selected=true;
						}

						AddChangeEventListener(searchCondFld,(function (fldCntr){return function() {changeFilterSearchTxtFld(searchCondFld, fldCntr);};})(fldCntr));

						var innerTblTD=CreateTD(innerTblTR, "", "searchTxtFldTD"+fldCntr);

						if(fltrNoForEdit && existingFilters[fltrNoForEdit-1]['operator'])
							searchTxtFldVal=existingFilters[fltrNoForEdit-1]['value'];
						var searchTxtFld=CreateTEXTBOX(innerTblTD, "inputFieldClass", "searchTxtFld"+fldCntr, searchTxtFldVal);
						searchTxtFld.maxLength="50";
						
						if(columnType=="Number"){
							searchTxtFld.setAttribute("onkeypress","return numbersonly(this,event,true);");
						}else if (columnType=="numeric"){
							searchTxtFld.setAttribute("onkeypress","return numbersonly(this,event,false);");
						}

						break;

					case "Number":
					case "DECIMAL":
					case "numeric":
						var condSpan=document.getElementById(contDivId);
						condSpan.innerHTML="";
						var innerTbl=CreateTable(condSpan);
						var innerTblBdy=CreateBody(innerTbl);
						var innerTblTR=CreateTR(innerTblBdy);
						var innerTblTD=CreateTD(innerTblTR);
						var searchCondFld=CreateSelectBox(innerTblTD, "inputFieldClass", "searchCondFld"+fldCntr);

						for (var condFld in operatorsNumericArray)
						{
							optBox=CreateOptionBox(searchCondFld, "", "", condFld, operatorsNumericArray[condFld]);
							if(fltrNoForEdit && existingFilters[fltrNoForEdit-1]['operator']==condFld)
								optBox.selected=true;
						}

						AddChangeEventListener(searchCondFld,(function (fldCntr){return function() {changeFilterSearchTxtFld(searchCondFld, fldCntr);};})(fldCntr));

						var innerTblTD=CreateTD(innerTblTR, "", "searchTxtFldTD"+fldCntr);

						if(fltrNoForEdit && existingFilters[fltrNoForEdit-1]['operator'])
							searchTxtFldVal=existingFilters[fltrNoForEdit-1]['value'];
						var searchTxtFld=CreateTEXTBOX(innerTblTD, "inputFieldClass", "searchTxtFld"+fldCntr, searchTxtFldVal);
						searchTxtFld.maxLength="50";
						
						if(columnType=="Number"){
							searchTxtFld.setAttribute("onkeypress","return numbersonly(this,event,true);");
						}else if (columnType=="numeric"){
							searchTxtFld.setAttribute("onkeypress","return numbersonly(this,event,false);");
						}

						break;

					case "Datetime":
					case "datetime":
					case "timestamp":
					case "TIMESTAMP":
						var condSpan=document.getElementById(contDivId);
						condSpan.innerHTML="";
						var innerTbl=CreateTable(condSpan);
						var innerTblBdy=CreateBody(innerTbl);
						var innerTblTR=CreateTR(innerTblBdy);
						var innerTblTD=CreateTD(innerTblTR);
						var searchCondFld=CreateSelectBox(innerTblTD, "inputFieldClass", "searchCondFld"+fldCntr);
						var searchCondFld=document.getElementById("searchCondFld"+fldCntr);
						for (var condFld in operatorsDateArray)
						{
							optBox=CreateOptionBox(searchCondFld, "", "", condFld, operatorsDateArray[condFld]);
							if(fltrNoForEdit && existingFilters[fltrNoForEdit-1]['operator']==condFld)
								optBox.selected=true;
						}
						
						AddChangeEventListener(searchCondFld,(function (fldCntr){return function() {changeFilterSearchTxtFld(searchCondFld, fldCntr, true);};})(fldCntr));

						var innerTblTD=CreateTD(innerTblTR, "", "searchTxtFldTD"+fldCntr);
						
						var searchTxtFldDateVal="";
						var searchTxtFldTimeVal="";
						if(fltrNoForEdit && existingFilters[fltrNoForEdit-1]['operator'])
						{
							searchTxtFldVal=existingFilters[fltrNoForEdit-1]['value'];
							searchTxtFldDateVal=existingFilters[fltrNoForEdit-1]['value'];
							searchTxtFldDateVal1 = formatDate(parseDate(searchTxtFldDateVal),'MM/dd/yyyy');
							searchTxtFldDateVal = formatDate(parseDate(searchTxtFldDateVal1),'dd/MM/yyyy');
							searchTxtFldTimeVal="12:00 AM";
						}

						var dateFldId="searchTxtFld"+fldCntr;
						innerTblTD.innerHTML+="<input type='hidden' id='"+dateFldId+"' value='"+searchTxtFldVal+"'/><input id='"+dateFldId+"_date_value' class='inputFieldClass' onblur=\"changeDate('"+dateFldId+"_date_value'); assignToDateFld('"+dateFldId+"');\" size=12 maxlength=12 style='width:100px' value='"+searchTxtFldDateVal+"'/><img src='/atCRM/images/calendar.gif' id='"+dateFldId+"_cal' alt='Pick Date' style='cursor:pointer;vertical-align:middle;padding-left:1px;'/>";
						var innerTblTD=CreateTD(innerTblTR, "", "searchTxtFldTD1"+fldCntr);
						innerTblTD.innerHTML+="<div class='combo'><input id='"+dateFldId+"_time_value' class='inputFieldClass' size=10 maxlength=8 style='width:70px; height:1.5em;display:none;' value='"+searchTxtFldTimeVal+"'/><ul style='top:1.2em'><li>12:00 AM</li><li>12:30 AM</li><li>01:00 AM</li><li>01:30 AM</li><li>02:00 AM</li><li>02:30 AM</li><li>03:00 AM</li><li>03:30 AM</li><li>04:00 AM</li><li>04:30 AM</li><li>05:00 AM</li><li>05:30 AM</li><li>06:00 AM</li><li>06:30 AM</li><li>07:00 AM</li><li>07:30 AM</li><li>08:00 AM</li><li>08:30 AM</li><li>09:00 AM</li><li>09:30 AM</li><li>10:00 AM</li><li>10:30 AM</li><li>11:00 AM</li><li>11:30 AM</li><li>12:00 PM</li><li>12:30 PM</li><li>01:00 PM</li><li>01:30 PM</li><li>02:00 PM</li><li>02:30 PM</li><li>03:00 PM</li><li>03:30 PM</li><li>04:00 PM</li><li>04:30 PM</li><li>05:00 PM</li><li>05:30 PM</li><li>06:00 PM</li><li>06:30 PM</li><li>07:00 PM</li><li>07:30 PM</li><li>08:00 PM</li><li>08:30 PM</li><li>09:00 PM</li><li>09:30 PM</li><li>10:00 PM</li><li>10:30 PM</li><li>11:00 PM</li><li>11:30 PM</li></ul></div>";
						new TimeCombo(dateFldId+'_time_value','#FFFFFF','#FFFFFF');
						changeTime(dateFldId+'_time_value');
						new Calendar({
							  inputField: dateFldId+'_date_value',
							  dateFormat: "%d/%m/%Y", 
							  trigger: dateFldId+"_cal",
							  bottomBar: true,
							  fdow:0,
							  min: 19000101,
							  max: 29991231,
							  align: "BL",
							  onSelect: function() {
								 this.hide();
								 var obj=document.getElementById(dateFldId+'_date_value');
								 obj.focus();
							  }
						});

						CreateTD(innerTblTR, "", "dateBetweenOprtrTD"+fldCntr);
						CreateTD(innerTblTR, "", "endDateDateTD"+fldCntr);
						CreateTD(innerTblTR, "", "endDateTimeTD"+fldCntr);
						
						break;
				}
			}

			var innerTblTD=CreateTD(innerTblTR);
			innerTblTD.innerHTML="<div id='addCriteriaDiv"+fldCntr+"' style='display:none'><input type='button' value='Add Criteria' class='greenButton' onclick=\"createFilterCriteria(0); hideThisFilter('addCriteriaDiv"+fldCntr+"');\" style='width:80px'/></div>";

			for(ii=0; ii<srchFldCntrArray.length; ii++)
			{
				hideThisFilter("addCriteriaDiv"+srchFldCntrArray[ii]);
			}

			if(srchFldCntrArray[srchFldCntrArray.length-1])
				showThisFilter("addCriteriaDiv"+srchFldCntrArray[srchFldCntrArray.length-1]);
		}

		function removeFilterCriteria(divIdAppender)
		{
			var removableCriteria=document.getElementById("containerDev"+divIdAppender);
			var container=document.getElementById('filterCriteriaBodyDiv');

			for(i=0; i<srchFldCntrArray.length; i++)
			{
				if(srchFldCntrArray[i]==divIdAppender)
					srchFldCntrArray.splice(i,1);
			}
			showThisFilter("addCriteriaDiv"+srchFldCntrArray[srchFldCntrArray.length-1]);
			container.removeChild(removableCriteria);
		}

		function changeFilterSearchTxtFld(selBox, dateFldCntr, isDateFld)
		{ 
			if(selBox.value=="isnull" || selBox.value=="isnotnull")
			{
				document.getElementById("searchTxtFldTD"+dateFldCntr).style.visibility="hidden";
				if(isDateFld)
				{
					document.getElementById("searchTxtFldTD1"+dateFldCntr).style.visibility="hidden";
					document.getElementById("dateBetweenOprtrTD"+dateFldCntr).style.visibility="hidden";
					document.getElementById("endDateDateTD"+dateFldCntr).style.visibility="hidden";
					document.getElementById("endDateTimeTD"+dateFldCntr).style.visibility="hidden";
				}
			}
			else
			{
				document.getElementById("searchTxtFldTD"+dateFldCntr).style.visibility="visible";
				if(isDateFld)
				{
					document.getElementById("searchTxtFldTD1"+dateFldCntr).style.visibility="visible";
					document.getElementById("dateBetweenOprtrTD"+dateFldCntr).style.visibility="visible";
					document.getElementById("endDateDateTD"+dateFldCntr).style.visibility="visible";
					document.getElementById("endDateTimeTD"+dateFldCntr).style.visibility="visible";
				}
			}

			if(selBox.value=="between")
			{
						var endDateDateTD=document.getElementById("endDateDateTD"+dateFldCntr);
						var endDateTimeTD=document.getElementById("endDateTimeTD"+dateFldCntr);
						document.getElementById("dateBetweenOprtrTD"+dateFldCntr).innerHTML="(and)";
						var dateFldId="searchTxtEndFld"+dateFldCntr;
						endDateDateTD.innerHTML+="<input type='hidden' id='"+dateFldId+"' /><input id='"+dateFldId+"_date_value' class='inputFieldClass' onblur=\"changeDate('"+dateFldId+"_date_value'); assignToDateFld('"+dateFldId+"');\" size=12 maxlength=12 style='width:100px'/><img src='/atCRM/images/calendar.gif' id='"+dateFldId+"_cal' alt='Pick Date' style='cursor:pointer;vertical-align:middle;padding-left:1px;'/>";

						endDateTimeTD.innerHTML+="<div class='combo'><input id='"+dateFldId+"_time_value' class='inputFieldClass' size=10 maxlength=8 style='width:70px; height:1.5em;'/><ul style='top:1.2em'><li>12:00 AM</li><li>12:30 AM</li><li>01:00 AM</li><li>01:30 AM</li><li>02:00 AM</li><li>02:30 AM</li><li>03:00 AM</li><li>03:30 AM</li><li>04:00 AM</li><li>04:30 AM</li><li>05:00 AM</li><li>05:30 AM</li><li>06:00 AM</li><li>06:30 AM</li><li>07:00 AM</li><li>07:30 AM</li><li>08:00 AM</li><li>08:30 AM</li><li>09:00 AM</li><li>09:30 AM</li><li>10:00 AM</li><li>10:30 AM</li><li>11:00 AM</li><li>11:30 AM</li><li>12:00 PM</li><li>12:30 PM</li><li>01:00 PM</li><li>01:30 PM</li><li>02:00 PM</li><li>02:30 PM</li><li>03:00 PM</li><li>03:30 PM</li><li>04:00 PM</li><li>04:30 PM</li><li>05:00 PM</li><li>05:30 PM</li><li>06:00 PM</li><li>06:30 PM</li><li>07:00 PM</li><li>07:30 PM</li><li>08:00 PM</li><li>08:30 PM</li><li>09:00 PM</li><li>09:30 PM</li><li>10:00 PM</li><li>10:30 PM</li><li>11:00 PM</li><li>11:30 PM</li></ul></div>";

						new TimeCombo(dateFldId+'_time_value','#FFFFFF','#FFFFFF');
						changeTime(dateFldId+'_time_value');
						new Calendar({
							  inputField: dateFldId+'_date_value',
							  dateFormat: "%d/%m/%Y", 
							  trigger: dateFldId+"_cal",
							  bottomBar: true,
							  fdow:0,
							  min: 19000101,
							  max: 29991231,
							  align: "BL",
							  onSelect: function() {
								 this.hide();
								 var obj=document.getElementById(dateFldId+'_date_value');
								 obj.focus();
							  }
						});							

			}
			else
			{
				if(document.getElementById("endDateDateTD"+dateFldCntr))
					document.getElementById("endDateDateTD"+dateFldCntr).innerHTML="";
				if(document.getElementById("endDateTimeTD"+dateFldCntr))		
					document.getElementById("endDateTimeTD"+dateFldCntr).innerHTML="";
				if(document.getElementById("dateBetweenOprtrTD"+dateFldCntr))
					document.getElementById("dateBetweenOprtrTD"+dateFldCntr).innerHTML="";
			}
		}

		function saveFilterCriteria()
		{
			var msg="";
			var allFieldMsg="";
			var getSearchfield=""
			var getSearchCondFld=""
			var getSearchTxtFld=""
			var getMatch=""
			var filterName=document.getElementById('filterName').value;
			if(filterId4Filter=="")
			{
				if(!checkFilterName(document.getElementById('filterName')))
					return false;
			}
			var isPublic="0";
			if(document.getElementById('isPublic').checked)
				var isPublic=document.getElementById('isPublic').value;
			if(filterName=="")
			{
				document.getElementById('filterName').style.border="1px solid #CC0000";
				msg="<li>Filter name should not be empty</li>";
			}
			else
			{
				document.getElementById('filterName').style.border="1px solid #DDDDDD";
			}
			var fltrCnd="<filter><description value=\""+filterName+"\"/><entityName value=\""+entityName4Filter+"\"/><orTerm>";
			for (srchFldCntrCnt=0; srchFldCntrCnt<srchFldCntrArray.length; srchFldCntrCnt++)
			{
				getSearchfield=document.getElementById("searchfield"+srchFldCntrArray[srchFldCntrCnt]).value;
				getSearchCondFld=document.getElementById("searchCondFld"+srchFldCntrArray[srchFldCntrCnt]).value;
				getSearchTxtFld=document.getElementById("searchTxtFld"+srchFldCntrArray[srchFldCntrCnt]).value;
				if(getSearchCondFld=="between") //for date fields
				{
					if(getSearchfield=="" || getSearchTxtFld=="")
						allFieldMsg="<li>Please select field and enter data for it.</li>";
					fltrCnd+="<andTerm>";
					fltrCnd+="<attribute value=\""+getSearchfield+"\"/>";
					fltrCnd+="<operator value=\"gt\"/>";
					fltrCnd+="<value value=\""+getSearchTxtFld+"\"/>";
					fltrCnd+="</andTerm>";
					
					var getSearchTxtEndFld=document.getElementById("searchTxtEndFld"+srchFldCntrArray[srchFldCntrCnt]).value;
					if(getSearchfield=="" || getSearchTxtEndFld=="")
						allFieldMsg="<li>Please select field and enter data for it.</li>";
					fltrCnd+="<andTerm>";
					fltrCnd+="<attribute value=\""+getSearchfield+"\"/>";
					fltrCnd+="<operator value=\"lt\"/>";
					fltrCnd+="<value value=\""+getSearchTxtEndFld+"\"/>";
					fltrCnd+="</andTerm>";
				}
				else if(getSearchCondFld=="isnull")
				{
					if(getSearchfield=="")
						allFieldMsg="<li>Please select field.</li>";
					fltrCnd+="<andTerm>";
					fltrCnd+="<attribute value=\""+getSearchfield+"\"/>";
					fltrCnd+="<operator value=\"is null\"/>";
					fltrCnd+="<value value=\"\"/>";
					fltrCnd+="</andTerm>";
				}
				else if(getSearchCondFld=="isnotnull")
				{
					if(getSearchfield=="")
						allFieldMsg="<li>Please select field.</li>";
					fltrCnd+="<andTerm>";
					fltrCnd+="<attribute value=\""+getSearchfield+"\"/>";
					fltrCnd+="<operator value=\"is not null\"/>";
					fltrCnd+="<value value=\"\"/>";
					fltrCnd+="</andTerm>";
				}
				else
				{
					if(srchFldCntrCnt==0 && (getSearchfield=="" || getSearchTxtFld==""))
					{
						allFieldMsg="<li>Please select field and enter data for it.</li>";
						if(getSearchfield=="")
							document.getElementById("searchfield"+srchFldCntrArray[srchFldCntrCnt]).style.border="1px solid #CC0000";
						else
							document.getElementById("searchfield"+srchFldCntrArray[srchFldCntrCnt]).style.border="1px solid #DDDDDD";

						if(getSearchTxtFld=="")
							document.getElementById("searchTxtFld"+srchFldCntrArray[srchFldCntrCnt]).style.border="1px solid #CC0000";
						else
							document.getElementById("searchTxtFld"+srchFldCntrArray[srchFldCntrCnt]).style.border="1px solid #DDDDDD";

						fltrCnd+="<andTerm>";
						fltrCnd+="<attribute value=\""+getSearchfield+"\"/>";
						fltrCnd+="<operator value=\""+getSearchCondFld+"\"/>";
						fltrCnd+="<value value=\""+getSearchTxtFld+"\"/>";
						fltrCnd+="</andTerm>";
					}
					else if(getSearchfield!="" && getSearchTxtFld=="")
					{
						allFieldMsg="<li>Please enter data for the selected field.</li>";
						document.getElementById("searchTxtFld"+srchFldCntrArray[srchFldCntrCnt]).style.border="1px solid #CC0000";
					}
					else if(getSearchfield!="" && getSearchTxtFld!="")
					{
						document.getElementById("searchTxtFld"+srchFldCntrArray[srchFldCntrCnt]).style.border="1px solid #DDDDDD";
						fltrCnd+="<andTerm>";
						fltrCnd+="<attribute value=\""+getSearchfield+"\"/>";
						fltrCnd+="<operator value=\""+getSearchCondFld+"\"/>";
						fltrCnd+="<value value=\""+getSearchTxtFld+"\"/>";
						fltrCnd+="</andTerm>";
					}
				}
			}
			fltrCnd+="</orTerm></filter>";
			msg+=allFieldMsg;
			if(msg)
			{
				document.getElementById('filterErrorDiv').innerHTML="Please correct these errors.<ul>"+msg+"</ul>";
				document.getElementById('filterErrorDiv').style.display="block";
				return false;
			}
			else
			{
				document.getElementById('filterErrorDiv').style.display="none";
			}
			
			var url2Hit=zcServletPrefix+"/custom/JSON/add/filters/editAction?0-1-2="+filterId4Filter+"&0-1-3="+filterName+"&0-1-4="+fltrCnd+"&0-1-5="+entityName4Filter+"&0-1-27="+isPublic;
			
			$.ajax({
				type: "GET",
				url:url2Hit,
				dataType: "text",
				async: true,
				success: function (data){
					top.callFilterPage(entityName4Filter);
				}
			});
		}


		function cancelFilterCriteria()
		{
			top.callFilterPage(entityName4Filter);
		}

		function assignToDateFld(dtElmId)
		{
			var dateFldObj=document.getElementById(dtElmId+'_date_value');
			var timeFldObj=document.getElementById(dtElmId+'_time_value');
			if(dateFldObj.value!="" && timeFldObj.value!="")
			{
				var timeFldVal=timeFldObj.value;
				var ap = timeFldVal.split(' ')[1];
				var hour = (timeFldVal.split(' ')[0]).split(':')[0];
				var minute = (timeFldVal.split(' ')[0]).split(':')[1];
				var second = "00";
				if(ap == "AM")
					{if (hour == 12)hour = "00";}
				else
					{hour=parseFloat(hour);if(hour < 12){hour = hour+12;};}
				timeFldVal = hour +':' +minute +':' +second;
				var d = parseDate(dateFldObj.value);
				dateFldVal = formatDate(d,'MM/dd/yyyy');
				document.getElementById(dtElmId).value=dateFldVal;
			}
			else if(dateFldObj.value!="")
			{
				var d = parseDate(dateFldObj.value);
				dateFldVal = formatDate(d,'MM/dd/yyyy');
				document.getElementById(dtElmId).value=dateFldVal;
			}				
		}

		function checkFilterName(filterName)
		{
			var msg="";
			var returnStatus=true;
			var isPublic="0";
			if(document.getElementById('isPublic').checked)
				var isPublic=document.getElementById('isPublic').value;
			var url2Hit=zcServletPrefix+"/custom/JSON/system/isFilterNameExists.json?entityName="+entityName4Filter+"&filterName="+filterName.value+"&isPublic="+isPublic;
			$.ajax({
				type: "GET",
				url:url2Hit,
				dataType: "json",
				async: false,
				success: function (data){
					if(data.filter_id!="0")
					{
						filterName.style.border="1px solid #CC0000";
						msg="<li>This Filter Name is already existing.</li>";
					}
					else
					{
						filterName.style.border="1px solid #DDDDDD";
					}
					if(msg)
					{
						document.getElementById('filterErrorDiv').innerHTML="Please correct these errors.<ul>"+msg+"</ul>";
						document.getElementById('filterErrorDiv').style.display="block";
						returnStatus=false;
					}
					else
					{
						document.getElementById('filterErrorDiv').style.display="none";
						returnStatus=true;
					}
				}
			});
			return returnStatus;
		}
	</script>
<body onload="initializeFilter();">

	<div id="divForFilterCreation" name="divForFilterCreation"></div>

	<div id="commonPopupDiv" name="commonPopupDiv"></div>


</body>
</html>
